<!DOCTYPE html>
<html>
<head>
<meta charset=utf-8 />
<title>PDFcrop</title>
  <style type="text/css">
	body, html { height:100%; background-color:#777777 }
	#view-container {width:100%; height:100%}
    #document-container { display:inline-block; position:relative; box-shadow:1px 2px 7px 1px; background-color:#fff }
    #pdfcanvas { display:block }
    #margins {opacity:0.3}
    #document-container .margin {background-color:black; position:absolute}
    #document-container .margin.v {width:5%; height:100%}
    #document-container .margin.h {width:100%; height:5%}
    #m0 {left:0px; top:0px}
    #m1 {left:0px; top:0px}
    #m2 {right:0px; top:0px}
    #m3 {left:0px; bottom:0px}
    #region {position:absolute; left:5%; right:5%; top:5%; bottom:5%; border:dashed 2px darkred; margin:-1px}
    #region .handle {position:absolute}
	#region.dragging .handle {opacity:0}
    #region .handle div {position:absolute; left:3px; top:3px; right:3px; bottom:3px}
    #region .handle:hover div {border-radius:5px; background-color:blue; opacity:0.3; box-shadow: 0px 0px 3px 3px blue;}
    #region .handle.v {width:16px; top:7px; bottom:7px}
    #region .handle.h {height:16px; left:7px; right:7px}
    #h0 {cursor:w-resize; left:-9px}
    #h1 {cursor:n-resize; top:-9px}
    #h2 {cursor:e-resize; right:-9px}
    #h3 {cursor:s-resize; bottom:-9px}
  </style>
</head>
<body>

<div id="view-container">

<div id="document-container">
  <canvas id="pdfcanvas"></canvas>
  <div id="margins">
    <div id="m0" class="margin v"></div>
    <div id="m1" class="margin h"></div>
    <div id="m2" class="margin v"></div>
    <div id="m3" class="margin h"></div>
  </div>
  <div id="region">
    <div id="h0" class="handle v"><div></div></div>
    <div id="h1" class="handle h"><div></div></div>
    <div id="h2" class="handle v"><div></div></div>
    <div id="h3" class="handle h"><div></div></div>
  </div>
</div>
  
</div>  


<script type="text/javascript" src="jquery-1.9.1.min.js"></script>

<script type="text/javascript">

$(function() {

var dragdirection = null;
var handles = [0,0,0,0];
var margins = [0,0,0,0];
var region = $('#region');
var doccontainer = $('#document-container');
var dragproperty1 = null;
var dragproperty2 = null;
var dragproperty3 = null;
var dragproperty4 = null;
var dragproperty5 = null;


enddrag = function () {
	if (dragdirection !== null) {
		region.removeClass('dragging');
		dragdirection = null;
	}
};

begindrag = function(event, direction) {
	enddrag();
	dragproperty1 = direction % 2 ? 'height' : 'width';
	dragproperty2 = ['left', 'top', 'right', 'bottom'][direction];
	dragproperty3 = direction % 2 ? 'pageY' : 'pageX';
	dragproperty4 = direction % 2 ? doccontainer.offset().top : doccontainer.offset().left;
	dragproperty5 = direction >= 2 ? -1 : 1;
	if (direction == 2)  dragproperty4 += doccontainer.width();
	if (direction == 3)  dragproperty4 += doccontainer.height();
	region.addClass('dragging');
	dragdirection = direction;
	drag(event);
};

drag = function(event) {
	if (dragdirection !== null) {
		var mpx = Math.max(0, dragproperty5 * (event[dragproperty3] - dragproperty4));
		// TODO: minimal width & height
		margins[dragdirection].css(dragproperty1, mpx);
		region.css(dragproperty2, mpx);
	}
}


for (var i=0; i!=4; i++) {
	margins[i] = $("#m"+i);
	handles[i] = $("#h"+i);
	handles[i].mousedown((function(j) {
		return function(event) {
			begindrag(event, j);
		};
	}(i)));
}

$(document).mouseup(enddrag);
//$(document).mouseout(enddrag); TODO
$(document).mousemove(drag);




});
</script>



  <!-- Use latest PDF.js build from Github -->
<!--  <script type="text/javascript" src="combined-pdf.js"></script> -->
  <script type="text/javascript" src="mockpdf.js"></script>
  
  <script type="text/javascript">
    //
    // NOTE:
    // Modifying the URL below to another server will likely *NOT* work. Because of browser
    // security restrictions, we have to use a file server with special headers
    // (CORS) - most servers don't support cross-origin browser requests.
    //
    var url = 'testpdfs/paper-charged-skyrmions.pdf';

    //
    // Disable workers to avoid yet another cross-origin issue (workers need the URL of
    // the script to be loaded, and dynamically loading a cross-origin script does
    // not work)
    //
    PDFJS.disableWorker = true;

    //
    // Asynchronous download PDF as an ArrayBuffer
    //
    PDFJS.getDocument(url).then(function getPdfHelloWorld(pdf) {
      //
      // Fetch the first page
      //
      pdf.getPage(1).then(function getPageHelloWorld(page) {
		// get original size of page
        var origviewport = page.getViewport(1);
		var origw = Math.max(1, origviewport.width);
		var origh = Math.max(1, origviewport.height);
		var space = document.getElementById("view-container");
		var availw = Math.max(100, space.offsetWidth - 30);
		var availh = Math.max(100, space.offsetHeight - 30);
		var scale = Math.min(availw/origw, availh/origh);

		// get viewport with correct size
		var viewport = page.getViewport(scale);

        //
        // Prepare canvas using PDF page dimensions
        //
        var canvas = document.getElementById('pdfcanvas');
        var context = canvas.getContext('2d');
        canvas.height = viewport.height;
        canvas.width = viewport.width;

        //
        // Render PDF page into canvas context
        //
        page.render({canvasContext: context, viewport: viewport});
      });
    });
  </script>

</body>
</html>
